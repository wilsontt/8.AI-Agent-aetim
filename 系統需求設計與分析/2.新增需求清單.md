# AETIM 專案新增需求清單

**文件版本**：v1.0  
**最後更新**：2025年11月6日  
**專案名稱**：AI 驅動之自動化威脅情資管理系統 (AETIM)

---

## 說明

本文件記錄 AETIM 專案開發過程中新增的需求，依時間順序排列。

---

## 新增需求清單（依時間順序）

### 2025年11月6日 - Web 管理界面（階段四）

#### 需求 1：Web 管理界面
**提出時間**：2025年11月6日  
**需求描述**：
建立一個完整的 Web 管理界面，讓使用者可以透過瀏覽器輕鬆管理系統設定、監控任務執行狀態、生成報告和發送通知。

**功能需求**：
1. **設定與控制區**：
   - 基本排程設定：顯示和修改收集任務的執行間隔
   - 動態排程設定：支援小時和分鐘兩種時間單位
   - 通知人員設定：Email 通知開關、SMTP 設定、收件者設定
   - 手動立即觸發：觸發收集任務、觸發關聯分析、觸發所有任務

2. **處理狀態與報告區**：
   - 處理狀態顯示：收集任務狀態、關聯分析狀態、即時日誌
   - 報告生成功能：選擇報告類型（CISO 週報、IT 工單）、選擇格式、顯示生成結果
   - 通知處理功能：選擇通知類型、選擇收件人、顯示通知結果

3. **即時更新**：
   - 自動更新日期時間顯示
   - 自動更新任務執行狀態（每 3 秒）
   - 自動更新下次執行時間倒數

**實作內容**：
- 建立 Flask Web 應用程式（`web_app.py`）
- 建立 Web 界面 HTML 模板（`templates/index.html`）
- 實作 RESTful API 端點
- 實作前端 JavaScript 動態更新機制
- 新增 Docker Compose 服務定義（`aetim-web`）

**修改檔案**：
- `aetim/web_app.py`：新增 Flask 應用程式和 API 端點
- `aetim/templates/index.html`：新增 Web 界面 HTML 模板
- `aetim/docker-compose.yml`：新增 `aetim-web` 服務

---

#### 需求 2：下次執行時間倒數顯示
**提出時間**：2025年11月6日  
**需求描述**：
在 Web 界面中顯示下次執行時間的倒數計時，並在動態排程設定修改、服務重新啟動或手動觸發後自動更新。

**實作內容**：
- 實作 `GET /api/scheduler/next-run` API 端點
- 實作前端 `updateCountdown()` 函數
- 實作定期更新機制（每秒更新一次）

**修改檔案**：
- `aetim/web_app.py`：新增 `GET /api/scheduler/next-run` 端點和 `scheduler_state` 全域字典
- `aetim/templates/index.html`：新增 `updateCountdown()` 函數

---

#### 需求 3：動態排程設定增強
**提出時間**：2025年11月6日  
**需求描述**：
- 執行間隔（小時）增加「不使用」選項
- 動態排程間隔時間應為小時＋分鐘的組合
- 小時和分鐘不能同時選擇「不使用」
- 將小時和分鐘設定並排顯示

**實作內容**：
- 修改動態排程設定 UI，新增「不使用」選項
- 實作排程計算邏輯：小時＋分鐘組合
- 實作驗證規則：小時和分鐘不能同時選擇「不使用」
- 調整 UI 布局，將小時和分鐘並排顯示

**修改檔案**：
- `aetim/templates/index.html`：修改動態排程設定 UI
- `aetim/web_app.py`：更新排程計算邏輯

---

#### 需求 4：多收件者 Email 設定
**提出時間**：2025年11月6日  
**需求描述**：
支援分別設定 CISO 和 IT 團隊不同的收件者 Email 地址。

**實作內容**：
- 將通知人員設定區分為「CISO Email」和「IT 團隊 Email」兩個獨立欄位
- 修改 `updateNotification()` 函數，支援分別設定 `ciso_email` 和 `it_email`
- 在發送通知時，根據選擇的收件者類型發送給對應的 Email 地址

**修改檔案**：
- `aetim/templates/index.html`：新增 CISO Email 和 IT Email 輸入欄位
- `aetim/web_app.py`：更新 `update_config` 函數處理多收件者設定

---

#### 需求 5：SMTP 設定獨立區塊
**提出時間**：2025年11月6日  
**需求描述**：
將 SMTP 設定從通知人員設定區獨立出來，建立獨立的「SMTP 設定」區塊，並新增「測試 SMTP」功能。

**功能需求**：
- SMTP 伺服器設定
- SMTP 埠口設定
- SMTP 使用者名稱和密碼設定
- 發送者 Email 設定
- TLS 設定
- SMTP 測試功能（測試自己寄給自己，測試時跳出視窗顯示寄送過程）

**實作內容**：
- 建立獨立的「SMTP 設定」區塊
- 實作 `POST /api/smtp/test` API 端點
- 實作前端 `testSMTP()` 和 `updateSMTP()` 函數
- 實作 SMTP 測試結果顯示

**修改檔案**：
- `aetim/templates/index.html`：新增 SMTP 設定區塊和測試功能
- `aetim/web_app.py`：新增 `POST /api/smtp/test` 端點

---

#### 需求 6：報告檔案自動折行顯示
**提出時間**：2025年11月6日  
**需求描述**：
報告生成後，檔案路徑應自動折行顯示，避免路徑過長時顯示不完整。

**實作內容**：
- 將報告檔案路徑顯示在藍色高亮框（`alert alert-info`）中
- 新增 CSS 屬性（`word-wrap`、`word-break`、`white-space`）實現自動折行

**修改檔案**：
- `aetim/templates/index.html`：修改報告檔案路徑顯示樣式

---

#### 需求 7：系統自動啟動功能
**提出時間**：2025年11月6日  
**需求描述**：
- 電腦啟動後，Docker 要自動啟動
- aetim 容器的服務也要自動啟動
- 服務正常啟動後，排程狀態為啟用（預設）時，立即觸發全部（收集＋分析），然後產生 CISO 報告

**實作內容**：
- 在 `docker-compose.yml` 中為兩個服務新增 `restart: unless-stopped` 設定
- 實作 `startup_tasks()` 函數，在 `web_app.py` 啟動時自動執行
- 當排程狀態為啟用時，自動觸發收集＋分析＋CISO 報告生成

**修改檔案**：
- `aetim/docker-compose.yml`：新增 `restart: unless-stopped` 設定
- `aetim/web_app.py`：新增 `startup_tasks()` 函數
- `aetim/scheduler.py`：修改啟動時自動執行邏輯

---

#### 需求 8：時區統一設定
**提出時間**：2025年11月6日  
**需求描述**：
- Docker 的時區設定在 Asia/Taipei UTC+8
- 所有時間戳記（後端日誌、前端顯示、報告檔名）都應使用 Asia/Taipei 時區

**實作內容**：
- 在 `Dockerfile` 中安裝 `tzdata` 套件並設定時區為 `Asia/Taipei`
- 在 `docker-compose.yml` 中為兩個服務新增 `TZ=Asia/Taipei` 環境變數
- 在後端 Python 程式中新增 `TAIPEI_TZ` 和 `get_taipei_time()` 函數
- 將所有 `datetime.now()` 替換為 `get_taipei_time()`
- 在前端 JavaScript 中，所有 `toLocaleString()` 呼叫都明確指定 `timeZone: 'Asia/Taipei'`

**修改檔案**：
- `aetim/Dockerfile`：新增時區設定
- `aetim/docker-compose.yml`：新增時區環境變數
- `aetim/web_app.py`：新增時區處理函數
- `aetim/reporting_engine.py`：新增時區處理函數
- `aetim/notification_handler.py`：新增時區處理函數
- `aetim/templates/index.html`：更新前端時間顯示邏輯

---

#### 需求 9：報告目錄結構優化
**提出時間**：2025年11月5日  
**需求描述**：
報告檔案應按年月自動分類儲存，目錄結構為 `reports/yyyy/yyyymm/`。

**實作內容**：
- 修改 `reporting_engine.py`，實作按年月自動建立目錄的邏輯
- 報告檔案命名規則：`ciso_weekly_YYYYMMDD_HHMMSS.html`、`it_ticket_YYYYMMDD_HHMMSS.json/text`

**修改檔案**：
- `aetim/reporting_engine.py`：實作按年月自動建立目錄的邏輯

---

## 需求統計

- **總需求數**：9 個
- **已完成需求數**：9 個
- **待實作需求數**：0 個

---

## 需求分類

### 功能需求
- 需求 1：Web 管理界面
- 需求 2：下次執行時間倒數顯示
- 需求 3：動態排程設定增強
- 需求 4：多收件者 Email 設定
- 需求 5：SMTP 設定獨立區塊
- 需求 6：報告檔案自動折行顯示
- 需求 9：報告目錄結構優化

### 系統需求
- 需求 7：系統自動啟動功能
- 需求 8：時區統一設定

---

## 參考文件

- `專案初始化摘要.md`
- `修改計劃-執行任務及測試報告/修改計劃_Web界面問題修正_20251106.md`
- `修改計劃-執行任務及測試報告/修改計劃_系統啟動與通知功能修正_20251106.md`
- `修改計劃-執行任務及測試報告/修改計劃_時區與通知修正_20251106.md`

---

**文件維護者**：開發團隊  
**最後審查日期**：2025年11月6日

