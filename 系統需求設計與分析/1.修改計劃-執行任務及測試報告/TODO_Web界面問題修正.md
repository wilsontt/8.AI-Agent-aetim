# AETIM Web 界面問題修正 - 任務追蹤清單

**開始日期：** 2025年11月06日  
**狀態：** 🔄 進行中

---

## 📋 任務清單

### 🎯 階段一：核心功能修正（優先級：高）

#### 1. 排程時間計算功能
- [ ] **Task 1.1**：新增排程時間查詢 API (`web_app.py`)
  - 新增 `GET /api/scheduler/next-run` 端點
  - 從 APScheduler 取得下次執行時間
  - 計算倒數時間
  - **預估時間**：2 小時

- [ ] **Task 1.2**：前端倒數時間顯示 (`templates/index.html`)
  - 修改 `nextRunTime` 顯示邏輯
  - 實現倒數時間計算（每 10 秒更新）
  - 格式化顯示
  - **預估時間**：2 小時

- [ ] **Task 1.3**：倒數時間重新計算觸發
  - 設定更新後重新計算
  - 手動觸發後重新計算
  - 服務重啟後重新計算
  - **預估時間**：1.5 小時

#### 2. 動態排程設定改進
- [ ] **Task 2.1**：小時選項增加「不使用」 (`templates/index.html`)
  - 在 `intervalHours` select 中增加「不使用」選項
  - **預估時間**：0.5 小時

- [ ] **Task 2.2**：排程設定 UI 改進（並排顯示） (`templates/index.html`)
  - 修改 CSS 樣式，使小時和分鐘並排顯示
  - **預估時間**：1 小時

- [ ] **Task 2.3**：排程間隔計算邏輯改進 (`web_app.py`, `scheduler.py`)
  - 實現小時+分鐘的計算（轉換為總分鐘數）
  - 驗證小時和分鐘不能同時為「不使用」
  - **預估時間**：2 小時

- [ ] **Task 2.4**：排程設定驗證 (`web_app.py`)
  - 前端和後端都添加驗證邏輯
  - 確保小時和分鐘不能同時選擇「不使用」
  - **預估時間**：1.5 小時

#### 3. IT 工單生成修復
- [ ] **Task 5.2**：IT 工單生成修復 (`web_app.py`)
  - 檢查 `generate_report` API 中的 IT 工單處理邏輯
  - 修復 IT 工單生成邏輯
  - 確保 IT 工單能夠正確生成並保存
  - 測試 IT 工單生成功能
  - **預估時間**：3 小時

---

### 🔧 階段二：功能改進（優先級：中）

#### 4. 任務狀態追蹤改進
- [ ] **Task 4.1**：「觸發全部」功能日誌改進 (`web_app.py`)
  - 在 `trigger_all` 函數中添加詳細日誌
  - 分別記錄每個收集器的執行狀態
  - 記錄關聯分析的詳細執行過程
  - **預估時間**：2 小時

- [ ] **Task 4.2**：狀態顯示改進 (`templates/index.html`)
  - 確保「觸發全部」的狀態和日誌能夠正確顯示
  - 與單獨觸發的顯示方式保持一致
  - **預估時間**：1 小時

#### 5. 報告生成狀態改進
- [ ] **Task 5.1**：報告生成狀態更新 (`web_app.py`)
  - 確保報告生成開始時狀態更新為「running」
  - 在生成過程中添加進度訊息
  - 完成後正確更新狀態
  - **預估時間**：1.5 小時

---

### 📧 階段三：通知功能改進（優先級：中）

#### 6. 通知收件者分組
- [ ] **Task 3.1**：通知設定結構變更 (`config.yaml`)
  - 修改通知設定結構，支援多收件者
  - 添加 CISO 和 IT 團隊收件者欄位
  - **預估時間**：0.5 小時

- [ ] **Task 3.2**：通知設定 UI 改進 (`templates/index.html`)
  - 分別顯示 CISO 和 IT 團隊的收件者輸入欄位
  - 更新設定儲存邏輯
  - **預估時間**：1.5 小時

- [ ] **Task 3.3**：通知發送邏輯更新 (`web_app.py`, `notification_handler.py`)
  - 根據通知類型選擇對應的收件者（CISO 或 IT 團隊）
  - 更新通知發送邏輯
  - **預估時間**：2 小時

#### 7. 通知處理改進
- [ ] **Task 6.1**：通知訊息顯示改進 (`web_app.py`, `templates/index.html`)
  - 在通知發送成功訊息中顯示收件者 Email
  - 顯示通知類型和收件者資訊
  - **預估時間**：1 小時

- [ ] **Task 6.2**：Email 發送問題排查 (`notification_handler.py`)
  - 檢查 SMTP 設定和連線
  - 添加詳細的錯誤日誌
  - 測試 Email 發送功能
  - 修復 Email 發送問題
  - **預估時間**：3 小時

---

## 📊 進度統計

- **總任務數**：13 項
- **已完成**：0 項
- **進行中**：0 項
- **待開始**：13 項
- **完成率**：0%

### 階段進度
- **階段一**：0/7 (0%)
- **階段二**：0/2 (0%)
- **階段三**：0/4 (0%)

---

## 🧪 測試清單

### 功能測試
- [ ] 測試排程時間計算和倒數顯示
- [ ] 測試動態排程設定（小時+分鐘）
- [ ] 測試「觸發全部」功能的狀態顯示
- [ ] 測試報告生成（CISO 週報和 IT 工單）
- [ ] 測試通知收件者分組功能
- [ ] 測試 Email 發送功能

### 邊界條件測試
- [ ] 測試小時和分鐘同時選擇「不使用」的情況
- [ ] 測試排程設定更新後的時間重新計算
- [ ] 測試手動觸發後的時間重新計算
- [ ] 測試服務重啟後的時間計算

### 整合測試
- [ ] 測試完整流程：設定更新 → 手動觸發 → 報告生成 → 通知發送
- [ ] 測試多使用者同時操作的情況
- [ ] 測試長時間運行的穩定性

---

## 📝 備註

- 所有任務預估時間基於初步評估，實際時間可能因問題複雜度而調整
- 優先處理階段一的任務，確保核心功能正常運作
- 每個任務完成後應進行單元測試，確保功能正常

---

**最後更新：** 2025年11月06日

