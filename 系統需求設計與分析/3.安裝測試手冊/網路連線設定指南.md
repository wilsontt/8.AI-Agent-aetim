# AETIM ç¶²è·¯é€£ç·šè¨­å®šæŒ‡å—

## ç›®éŒ„
1. [æ¸¬è©¦ç’°å¢ƒè¨­å®š](#æ¸¬è©¦ç’°å¢ƒè¨­å®š)
2. [é˜²ç«ç‰†è¨­å®š](#é˜²ç«ç‰†è¨­å®š)
3. [ç”Ÿç”¢ç’°å¢ƒè¨­å®š](#ç”Ÿç”¢ç’°å¢ƒè¨­å®š)
4. [å®‰å…¨å»ºè­°](#å®‰å…¨å»ºè­°)

---

## æ¸¬è©¦ç’°å¢ƒè¨­å®š

### å•é¡Œæè¿°
ç›®å‰åªæœ‰æœ¬æ©Ÿå¯ä»¥é€£åˆ° `http://localhost:5001` æˆ– `http://192.168.117.2:5000`ï¼Œå…¶ä»–åŒä»ç„¡æ³•é€£ç·šã€‚

### è§£æ±ºæ–¹æ¡ˆ

#### 1. ç¢ºèª Docker ç«¯å£ç¶å®šè¨­å®š

å·²ä¿®æ”¹ `docker-compose.yml`ï¼Œæ˜ç¢ºæŒ‡å®šç«¯å£ç¶å®šåˆ°æ‰€æœ‰ç¶²è·¯ä»‹é¢ï¼š

```yaml
ports:
  - "0.0.0.0:5001:5000"
```

é€™ç¢ºä¿ Docker ç›£è½æ‰€æœ‰ç¶²è·¯ä»‹é¢ï¼Œè€Œä¸åªæ˜¯ localhostã€‚

#### 2. ç¢ºèª Flask æ‡‰ç”¨ç¨‹å¼è¨­å®š

`web_app.py` å·²æ­£ç¢ºè¨­å®šç‚ºï¼š

```python
app.run(host='0.0.0.0', port=5000, debug=True)
```

é€™ç¢ºä¿ Flask ç›£è½å®¹å™¨å…§çš„æ‰€æœ‰ç¶²è·¯ä»‹é¢ã€‚

#### 3. é‡æ–°å•Ÿå‹•æœå‹™

ä¿®æ”¹è¨­å®šå¾Œï¼Œéœ€è¦é‡æ–°å•Ÿå‹•æœå‹™ï¼š

```bash
cd aetim
docker-compose down
docker-compose up -d
```

#### 4. ç¢ºèªæœå‹™ç‹€æ…‹

æª¢æŸ¥ç«¯å£æ˜¯å¦æ­£ç¢ºç›£è½ï¼š

```bash
# macOS/Linux
netstat -an | grep 5001
# æˆ–
lsof -i :5001

# æ‡‰è©²çœ‹åˆ°é¡ä¼¼ï¼š
# *:5001 (LISTEN) æˆ– 0.0.0.0:5001 (LISTEN)
```

#### 5. æ¸¬è©¦é€£ç·š

å…¶ä»–åŒä»å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»»ä¸€ URL é€£ç·šï¼š

- `http://10.9.81.112:5001`ï¼ˆä½¿ç”¨æ‚¨çš„å¯¦é«” IPï¼‰
- `http://æ‚¨çš„é›»è…¦åç¨±:5001`ï¼ˆå¦‚æœ DNS å¯è§£æï¼‰

---

## é˜²ç«ç‰†è¨­å®š

### macOS é˜²ç«ç‰†è¨­å®š

1. **ç³»çµ±åå¥½è¨­å®š** â†’ **å®‰å…¨æ€§èˆ‡éš±ç§** â†’ **é˜²ç«ç‰†**
2. å¦‚æœé˜²ç«ç‰†å·²å•Ÿç”¨ï¼Œéœ€è¦å…è¨± Docker æˆ– Python é€šéé˜²ç«ç‰†
3. æˆ–è€…æš«æ™‚é—œé–‰é˜²ç«ç‰†é€²è¡Œæ¸¬è©¦

### Linux é˜²ç«ç‰†è¨­å®šï¼ˆUbuntu/Debianï¼‰

å¦‚æœä½¿ç”¨ `ufw`ï¼š

```bash
# å…è¨± 5001 ç«¯å£
sudo ufw allow 5001/tcp

# æª¢æŸ¥ç‹€æ…‹
sudo ufw status
```

å¦‚æœä½¿ç”¨ `firewalld`ï¼ˆCentOS/RHELï¼‰ï¼š

```bash
# å…è¨± 5001 ç«¯å£
sudo firewall-cmd --permanent --add-port=5001/tcp
sudo firewall-cmd --reload

# æª¢æŸ¥ç‹€æ…‹
sudo firewall-cmd --list-ports
```

### Windows é˜²ç«ç‰†è¨­å®š

1. **æ§åˆ¶å°** â†’ **Windows Defender é˜²ç«ç‰†** â†’ **é€²éšè¨­å®š**
2. **è¼¸å…¥è¦å‰‡** â†’ **æ–°å¢è¦å‰‡**
3. é¸æ“‡ **é€£æ¥åŸ ** â†’ **TCP** â†’ **ç‰¹å®šæœ¬æ©Ÿé€£æ¥åŸ ï¼š5001**
4. å…è¨±é€£ç·š

---

## ç”Ÿç”¢ç’°å¢ƒè¨­å®š

### æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ Nginx åå‘ä»£ç†ï¼ˆæ¨è–¦ï¼‰

ä½¿ç”¨ Nginx ä½œç‚ºåå‘ä»£ç†ï¼Œæä¾› SSL/TLS åŠ å¯†å’ŒåŸºæœ¬èªè­‰ã€‚

#### 1. å»ºç«‹ Nginx è¨­å®šæª”

å»ºç«‹ `nginx/aetim.conf`ï¼š

```nginx
server {
    listen 80;
    server_name your-domain.com;  # æˆ–æ‚¨çš„ IP ä½å€
    
    # é‡å®šå‘åˆ° HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name your-domain.com;  # æˆ–æ‚¨çš„ IP ä½å€
    
    # SSL æ†‘è­‰è¨­å®šï¼ˆä½¿ç”¨ Let's Encryptï¼‰
    ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;
    
    # SSL è¨­å®š
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;
    
    # åŸºæœ¬èªè­‰ï¼ˆå¯é¸ï¼Œä½†å¼·çƒˆå»ºè­°ï¼‰
    auth_basic "AETIM Access";
    auth_basic_user_file /etc/nginx/.htpasswd;
    
    # æ—¥èªŒè¨­å®š
    access_log /var/log/nginx/aetim_access.log;
    error_log /var/log/nginx/aetim_error.log;
    
    # åå‘ä»£ç†è¨­å®š
    location / {
        proxy_pass http://localhost:5001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # WebSocket æ”¯æ´ï¼ˆå¦‚æœéœ€è¦ï¼‰
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        
        # è¶…æ™‚è¨­å®š
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
    
    # éœæ…‹æª”æ¡ˆå¿«å–ï¼ˆå¦‚æœæœ‰ï¼‰
    location /static/ {
        alias /path/to/static/files/;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
}
```

#### 2. å»ºç«‹åŸºæœ¬èªè­‰æª”æ¡ˆ

```bash
# å®‰è£ htpasswdï¼ˆå¦‚æœå°šæœªå®‰è£ï¼‰
# Ubuntu/Debian:
sudo apt-get install apache2-utils

# CentOS/RHEL:
sudo yum install httpd-tools

# å»ºç«‹èªè­‰æª”æ¡ˆ
sudo htpasswd -c /etc/nginx/.htpasswd username
# è¼¸å…¥å¯†ç¢¼ï¼Œæœƒå»ºç«‹åŠ å¯†çš„å¯†ç¢¼æª”æ¡ˆ

# æ–°å¢æ›´å¤šä½¿ç”¨è€…ï¼ˆä¸éœ€è¦ -c åƒæ•¸ï¼‰
sudo htpasswd /etc/nginx/.htpasswd another_user
```

#### 3. è¨­å®š SSL æ†‘è­‰ï¼ˆLet's Encryptï¼‰

```bash
# å®‰è£ Certbot
sudo apt-get install certbot python3-certbot-nginx

# å–å¾—æ†‘è­‰ï¼ˆè‡ªå‹•è¨­å®š Nginxï¼‰
sudo certbot --nginx -d your-domain.com

# æˆ–æ‰‹å‹•å–å¾—æ†‘è­‰
sudo certbot certonly --standalone -d your-domain.com
```

#### 4. æ›´æ–° docker-compose.ymlï¼ˆç”Ÿç”¢ç’°å¢ƒï¼‰

å»ºç«‹ `docker-compose.prod.yml`ï¼š

```yaml
services:
  aetim-web:
    # ... å…¶ä»–è¨­å®š ...
    ports:
      # åªç¶å®šåˆ° localhostï¼Œç”± Nginx åå‘ä»£ç†
      - "127.0.0.1:5001:5000"
    # ç§»é™¤ debug æ¨¡å¼
    environment:
      - TZ=Asia/Taipei
      - FLASK_ENV=production
```

#### 5. å•Ÿå‹•æœå‹™

```bash
# å•Ÿå‹• AETIM æœå‹™
docker-compose -f docker-compose.prod.yml up -d

# é‡æ–°è¼‰å…¥ Nginx
sudo nginx -t  # æ¸¬è©¦è¨­å®šæª”
sudo systemctl reload nginx
```

### æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ Docker ç¶²è·¯ + é˜²ç«ç‰†é™åˆ¶

å¦‚æœä¸æƒ³ä½¿ç”¨ Nginxï¼Œå¯ä»¥ï¼š

1. **åªå…è¨±ç‰¹å®š IP é€£ç·š**ï¼ˆä½¿ç”¨é˜²ç«ç‰†è¦å‰‡ï¼‰

```bash
# Ubuntu/Debian (ufw)
sudo ufw allow from 10.9.0.0/16 to any port 5001
sudo ufw allow from 192.168.0.0/16 to any port 5001

# åªå…è¨±ç‰¹å®š IP
sudo ufw allow from 10.9.81.50 to any port 5001
```

2. **ä½¿ç”¨ Docker ç¶²è·¯éš”é›¢**

```yaml
# docker-compose.yml
services:
  aetim-web:
    networks:
      - aetim-network
    # ä¸æš´éœ²ç«¯å£åˆ°ä¸»æ©Ÿ

networks:
  aetim-network:
    driver: bridge
```

ç„¶å¾Œä½¿ç”¨ Nginx æˆ–å…¶ä»–åå‘ä»£ç†é€£æ¥åˆ° Docker ç¶²è·¯ã€‚

### æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨ VPNï¼ˆæœ€å®‰å…¨ï¼‰

1. è¨­å®š VPN ä¼ºæœå™¨ï¼ˆä¾‹å¦‚ OpenVPNã€WireGuardï¼‰
2. åªæœ‰é€£æ¥åˆ° VPN çš„ä½¿ç”¨è€…æ‰èƒ½è¨ªå• AETIM
3. AETIM åªç¶å®šåˆ° VPN ç¶²è·¯ä»‹é¢

---

## å®‰å…¨å»ºè­°

### 1. åŸºæœ¬å®‰å…¨æªæ–½

- âœ… **ä½¿ç”¨ HTTPS**ï¼šç”Ÿç”¢ç’°å¢ƒå¿…é ˆä½¿ç”¨ SSL/TLS åŠ å¯†
- âœ… **åŸºæœ¬èªè­‰**ï¼šä½¿ç”¨ Nginx åŸºæœ¬èªè­‰æˆ–æ‡‰ç”¨ç¨‹å¼å±¤èªè­‰
- âœ… **é˜²ç«ç‰†è¦å‰‡**ï¼šåªå…è¨±å¿…è¦çš„ IP ç¯„åœé€£ç·š
- âœ… **é—œé–‰ Debug æ¨¡å¼**ï¼šç”Ÿç”¢ç’°å¢ƒè¨­å®š `FLASK_ENV=production`
- âœ… **å®šæœŸæ›´æ–°**ï¼šä¿æŒ Docker æ˜ åƒæª”å’Œç³»çµ±æ›´æ–°

### 2. é€²éšå®‰å…¨æªæ–½

- ğŸ”’ **ä½¿ç”¨æ‡‰ç”¨ç¨‹å¼å±¤èªè­‰**ï¼šå¯¦ä½œä½¿ç”¨è€…ç™»å…¥ç³»çµ±ï¼ˆFlask-Loginï¼‰
- ğŸ”’ **IP ç™½åå–®**ï¼šåœ¨ Nginx æˆ–æ‡‰ç”¨ç¨‹å¼ä¸­å¯¦ä½œ IP ç™½åå–®
- ğŸ”’ **Rate Limiting**ï¼šé™åˆ¶è«‹æ±‚é »ç‡ï¼Œé˜²æ­¢æš´åŠ›æ”»æ“Š
- ğŸ”’ **æ—¥èªŒç›£æ§**ï¼šç›£æ§ç•°å¸¸é€£ç·šå’Œå­˜å–è¨˜éŒ„
- ğŸ”’ **å‚™ä»½ç­–ç•¥**ï¼šå®šæœŸå‚™ä»½è³‡æ–™åº«å’Œè¨­å®šæª”

### 3. ç›£æ§èˆ‡æ—¥èªŒ

```bash
# æŸ¥çœ‹ Nginx å­˜å–æ—¥èªŒ
sudo tail -f /var/log/nginx/aetim_access.log

# æŸ¥çœ‹ AETIM å®¹å™¨æ—¥èªŒ
docker-compose logs -f aetim-web

# ç›£æ§é€£ç·šæ•¸
netstat -an | grep :5001 | wc -l
```

### 4. æ¸¬è©¦æ¸…å–®

åœ¨éƒ¨ç½²åˆ°ç”Ÿç”¢ç’°å¢ƒå‰ï¼Œè«‹ç¢ºèªï¼š

- [ ] SSL æ†‘è­‰å·²æ­£ç¢ºè¨­å®šä¸”æœªéæœŸ
- [ ] åŸºæœ¬èªè­‰æˆ–æ‡‰ç”¨ç¨‹å¼èªè­‰å·²å•Ÿç”¨
- [ ] é˜²ç«ç‰†è¦å‰‡å·²æ­£ç¢ºè¨­å®š
- [ ] Debug æ¨¡å¼å·²é—œé–‰
- [ ] æ—¥èªŒè¨˜éŒ„å·²å•Ÿç”¨
- [ ] å‚™ä»½æ©Ÿåˆ¶å·²è¨­å®š
- [ ] åªæœ‰æˆæ¬Šäººå“¡çŸ¥é“å­˜å– URL å’Œèªè­‰è³‡è¨Š

---

## æ•…éšœæ’é™¤

### å•é¡Œ 1ï¼šç„¡æ³•å¾å¤–éƒ¨é€£ç·š

**æª¢æŸ¥é …ç›®ï¼š**
1. Docker ç«¯å£æ˜ å°„æ˜¯å¦æ­£ç¢ºï¼š`docker-compose ps`
2. é˜²ç«ç‰†æ˜¯å¦é˜»æ“‹ï¼š`sudo ufw status` æˆ–æª¢æŸ¥ç³»çµ±é˜²ç«ç‰†
3. Flask æ˜¯å¦ç›£è½æ­£ç¢ºï¼š`docker-compose logs aetim-web`
4. ç¶²è·¯é€£ç·šæ˜¯å¦æ­£å¸¸ï¼š`ping 10.9.81.105`

### å•é¡Œ 2ï¼šé€£ç·šç·©æ…¢æˆ–è¶…æ™‚

**å¯èƒ½åŸå› ï¼š**
- ç¶²è·¯å»¶é²
- é˜²ç«ç‰†è¦å‰‡éæ–¼åš´æ ¼
- Docker è³‡æºé™åˆ¶

**è§£æ±ºæ–¹æ¡ˆï¼š**
- æª¢æŸ¥ç¶²è·¯é€£ç·šå“è³ª
- èª¿æ•´ Nginx è¶…æ™‚è¨­å®š
- å¢åŠ  Docker è³‡æºé™åˆ¶

### å•é¡Œ 3ï¼šSSL æ†‘è­‰éŒ¯èª¤

**æª¢æŸ¥é …ç›®ï¼š**
- æ†‘è­‰æ˜¯å¦éæœŸï¼š`sudo certbot certificates`
- æ†‘è­‰è·¯å¾‘æ˜¯å¦æ­£ç¢º
- Nginx è¨­å®šæª”èªæ³•æ˜¯å¦æ­£ç¢ºï¼š`sudo nginx -t`

---

## åƒè€ƒè³‡æº

- [Nginx å®˜æ–¹æ–‡ä»¶](https://nginx.org/en/docs/)
- [Let's Encrypt æ–‡ä»¶](https://letsencrypt.org/docs/)
- [Docker ç¶²è·¯æ–‡ä»¶](https://docs.docker.com/network/)
- [Flask éƒ¨ç½²æ–‡ä»¶](https://flask.palletsprojects.com/en/2.3.x/deploying/)

---

**æœ€å¾Œæ›´æ–°**ï¼š2025å¹´11æœˆ6æ—¥  
**ç¶­è­·è€…**ï¼šé–‹ç™¼åœ˜éšŠ

